/*
 * jQuery Raty - A Star Rating Plugin
 *
 * The MIT License
 *
 * @author  : Washington Botelho
 * @doc     : http://wbotelhos.com/raty
 * @version : 2.7.0
 *
 */
(function(a){var b={init:function(c){return this.each(function(){this.self=a(this);b.destroy.call(this.self);this.opt=a.extend(true,{},a.fn.raty.defaults,c);b._adjustCallback.call(this);b._adjustNumber.call(this);b._adjustHints.call(this);this.opt.score=b._adjustedScore.call(this,this.opt.score);if(this.opt.starType!=="img"){b._adjustStarType.call(this)}b._adjustPath.call(this);b._createStars.call(this);if(this.opt.cancel){b._createCancel.call(this)}if(this.opt.precision){b._adjustPrecision.call(this)}b._createScore.call(this);b._apply.call(this,this.opt.score);b._setTitle.call(this,this.opt.score);b._target.call(this,this.opt.score);if(this.opt.readOnly){b._lock.call(this)}else{this.style.cursor="pointer";b._binds.call(this)}})},_adjustCallback:function(){var d=["number","readOnly","score","scoreName","target"];for(var c=0;c<d.length;c++){if(typeof this.opt[d[c]]==="function"){this.opt[d[c]]=this.opt[d[c]].call(this)}}},_adjustedScore:function(c){if(!c){return c}return b._between(c,0,this.opt.number)},_adjustHints:function(){if(!this.opt.hints){this.opt.hints=[]}if(!this.opt.halfShow&&!this.opt.half){return}var f=this.opt.precision?10:2;for(var g=0;g<this.opt.number;g++){var d=this.opt.hints[g];if(Object.prototype.toString.call(d)!=="[object Array]"){d=[d]}this.opt.hints[g]=[];for(var e=0;e<f;e++){var c=d[e],h=d[d.length-1];if(h===undefined){h=null}this.opt.hints[g][e]=c===undefined?h:c}}},_adjustNumber:function(){this.opt.number=b._between(this.opt.number,1,this.opt.numberMax)},_adjustPath:function(){this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.charAt(this.opt.path.length-1)!=="/"){this.opt.path+="/"}},_adjustPrecision:function(){this.opt.half=true},_adjustStarType:function(){var d=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var c=0;c<d.length;c++){this.opt[d[c]]=this.opt[d[c]].replace(".","-")}},_apply:function(c){b._fill.call(this,c);if(c){if(c>0){this.score.val(c)}b._roundStars.call(this,c)}},_between:function(e,c,d){return Math.min(Math.max(parseFloat(e),c),d)},_binds:function(){if(this.cancel){b._bindOverCancel.call(this);b._bindClickCancel.call(this);b._bindOutCancel.call(this)}b._bindOver.call(this);b._bindClick.call(this);b._bindOut.call(this)},_bindClick:function(){var c=this;c.stars.on("click.raty",function(d){var f=true,e=(c.opt.half||c.opt.precision)?c.self.data("score"):(this.alt||a(this).data("alt"));if(c.opt.click){f=c.opt.click.call(c,+e,d)}if(f||f===undefined){if(c.opt.half&&!c.opt.precision){e=b._roundHalfScore.call(c,e)}b._apply.call(c,e)}})},_bindClickCancel:function(){var c=this;c.cancel.on("click.raty",function(d){c.score.removeAttr("value");if(c.opt.click){c.opt.click.call(c,null,d)}})},_bindOut:function(){var c=this;c.self.on("mouseleave.raty",function(d){var e=+c.score.val()||undefined;b._apply.call(c,e);b._target.call(c,e,d);b._resetTitle.call(c);if(c.opt.mouseout){c.opt.mouseout.call(c,e,d)}})},_bindOutCancel:function(){var c=this;c.cancel.on("mouseleave.raty",function(d){var f=c.opt.cancelOff;if(c.opt.starType!=="img"){f=c.opt.cancelClass+" "+f}b._setIcon.call(c,this,f);if(c.opt.mouseout){var e=+c.score.val()||undefined;c.opt.mouseout.call(c,e,d)}})},_bindOver:function(){var c=this,d=c.opt.half?"mousemove.raty":"mouseover.raty";c.stars.on(d,function(e){var f=b._getScoreByPosition.call(c,e,this);b._fill.call(c,f);if(c.opt.half){b._roundStars.call(c,f,e);b._setTitle.call(c,f,e);c.self.data("score",f)}b._target.call(c,f,e);if(c.opt.mouseover){c.opt.mouseover.call(c,f,e)}})},_bindOverCancel:function(){var c=this;c.cancel.on("mouseover.raty",function(e){var d=c.opt.path+c.opt.starOff,f=c.opt.cancelOn;if(c.opt.starType==="img"){c.stars.attr("src",d)}else{f=c.opt.cancelClass+" "+f;c.stars.attr("class",d)}b._setIcon.call(c,this,f);b._target.call(c,null,e);if(c.opt.mouseover){c.opt.mouseover.call(c,null)}})},_buildScoreField:function(){return a("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this)},_createCancel:function(){var d=this.opt.path+this.opt.cancelOff,c=a("<"+this.opt.starType+" />",{title:this.opt.cancelHint,"class":this.opt.cancelClass});if(this.opt.starType==="img"){c.attr({src:d,alt:"x"})}else{c.attr("data-alt","x").addClass(d)}if(this.opt.cancelPlace==="left"){this.self.prepend(" ").prepend(c)}else{this.self.append(" ").append(c)}this.cancel=c},_createScore:function(){var c=a(this.opt.targetScore);this.score=c.length?c:b._buildScoreField.call(this)},_createStars:function(){for(var e=1;e<=this.opt.number;e++){var d=b._nameForIndex.call(this,e),c={alt:e,src:this.opt.path+this.opt[d]};if(this.opt.starType!=="img"){c={"data-alt":e,"class":c.src}}c.title=b._getHint.call(this,e);a("<"+this.opt.starType+" />",c).appendTo(this);if(this.opt.space){this.self.append(e<this.opt.number?" ":"")}}this.stars=this.self.children(this.opt.starType)},_error:function(c){a(this).text(c);a.error(c)},_fill:function(c){var e=0;for(var f=1;f<=this.stars.length;f++){var j,g=this.stars[f-1],h=b._turnOn.call(this,f,c);if(this.opt.iconRange&&this.opt.iconRange.length>e){var d=this.opt.iconRange[e];j=b._getRangeIcon.call(this,d,h);if(f<=d.range){b._setIcon.call(this,g,j)}if(f===d.range){e++}}else{j=this.opt[h?"starOn":"starOff"];b._setIcon.call(this,g,j)}}},_getFirstDecimal:function(e){var c=e.toString().split(".")[1],d=0;if(c){d=parseInt(c.charAt(0),10);if(c.slice(1,5)==="9999"){d++}}return d},_getRangeIcon:function(c,d){return d?c.on||this.opt.starOn:c.off||this.opt.starOff},_getScoreByPosition:function(c,g){var f=parseInt(g.alt||g.getAttribute("data-alt"),10);if(this.opt.half){var e=b._getWidth.call(this),d=parseFloat((c.pageX-a(g).offset().left)/e);f=f-1+d}return f},_getHint:function(c,g){if(c!==0&&!c){return this.opt.noRatedMsg}var h=b._getFirstDecimal.call(this,c),i=Math.ceil(c),f=this.opt.hints[(i||1)-1],e=f,d=!g||this.move;if(this.opt.precision){if(d){h=h===0?9:h-1}e=f[h]}else{if(this.opt.halfShow||this.opt.half){h=d&&h===0?1:h>5?1:0;e=f[h]}}return e===""?"":e||c},_getWidth:function(){var c=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));if(!c){b._error.call(this,"Could not get the icon width!")}return c},_lock:function(){var c=b._getHint.call(this,this.score.val());this.style.cursor="";this.title=c;this.score.prop("readonly",true);this.stars.prop("title",c);if(this.cancel){this.cancel.hide()}this.self.data("readonly",true)},_nameForIndex:function(c){return this.opt.score&&this.opt.score>=c?"starOn":"starOff"},_resetTitle:function(c){for(var d=0;d<this.opt.number;d++){this.stars[d].title=b._getHint.call(this,d+1)}},_roundHalfScore:function(e){var c=parseInt(e,10),d=b._getFirstDecimal.call(this,e);if(d!==0){d=d>5?1:0.5}return c+d},_roundStars:function(c,e){var g=(c%1).toFixed(2),d;if(e||this.move){d=g>0.5?"starOn":"starHalf"}else{if(g>this.opt.round.down){d="starOn";if(this.opt.halfShow&&g<this.opt.round.up){d="starHalf"}else{if(g<this.opt.round.full){d="starOff"}}}}if(d){var h=this.opt[d],f=this.stars[Math.ceil(c)-1];b._setIcon.call(this,f,h)}},_setIcon:function(c,d){c[this.opt.starType==="img"?"src":"className"]=this.opt.path+d},_setTarget:function(c,d){if(d){d=this.opt.targetFormat.toString().replace("{score}",d)}if(c.is(":input")){c.val(d)}else{c.html(d)}},_setTitle:function(e,c){if(e){var f=parseInt(Math.ceil(e),10),d=this.stars[f-1];d.title=b._getHint.call(this,e,c)}},_target:function(g,c){if(this.opt.target){var d=a(this.opt.target);if(!d.length){b._error.call(this,"Target selector invalid or missing!")}var e=c&&c.type==="mouseover";if(g===undefined){g=this.opt.targetText}else{if(g===null){g=e?this.opt.cancelHint:this.opt.targetText}else{if(this.opt.targetType==="hint"){g=b._getHint.call(this,g,c)}else{if(this.opt.precision){g=parseFloat(g).toFixed(1)}}var f=c&&c.type==="mousemove";if(!e&&!f&&!this.opt.targetKeep){g=this.opt.targetText}}}b._setTarget.call(this,d,g)}},_turnOn:function(c,d){return this.opt.single?(c===d):(c<=d)},_unlock:function(){this.style.cursor="pointer";this.removeAttribute("title");this.score.removeAttr("readonly");this.self.data("readonly",false);for(var c=0;c<this.opt.number;c++){this.stars[c].title=b._getHint.call(this,c+1)}if(this.cancel){this.cancel.css("display","")}},cancel:function(c){return this.each(function(){var d=a(this);if(d.data("readonly")!==true){b[c?"click":"score"].call(d,null);this.score.removeAttr("value")}})},click:function(c){return this.each(function(){if(a(this).data("readonly")!==true){c=b._adjustedScore.call(this,c);b._apply.call(this,c);if(this.opt.click){this.opt.click.call(this,c,a.Event("click"))}b._target.call(this,c)}})},destroy:function(){return this.each(function(){var c=a(this),d=c.data("raw");if(d){c.off(".raty").empty().css({cursor:d.style.cursor}).removeData("readonly")}else{c.data("raw",c.clone()[0])}})},getScore:function(){var d=[],c;this.each(function(){c=this.score.val();d.push(c?+c:undefined)});return(d.length>1)?d:d[0]},move:function(c){return this.each(function(){var j=parseInt(c,10),e=b._getFirstDecimal.call(this,c);if(j>=this.opt.number){j=this.opt.number-1;e=10}var i=b._getWidth.call(this),f=i/10,g=a(this.stars[j]),d=g.offset().left+f*e,h=a.Event("mousemove",{pageX:d});this.move=true;g.trigger(h);this.move=false})},readOnly:function(c){return this.each(function(){var d=a(this);if(d.data("readonly")!==c){if(c){d.off(".raty").children("img").off(".raty");b._lock.call(this)}else{b._binds.call(this);b._unlock.call(this)}d.data("readonly",c)}})},reload:function(){return b.set.call(this,{})},score:function(){var c=a(this);return arguments.length?b.setScore.apply(c,arguments):b.getScore.call(c)},set:function(c){return this.each(function(){a(this).raty(a.extend({},this.opt,c))})},setScore:function(c){return this.each(function(){if(a(this).data("readonly")!==true){c=b._adjustedScore.call(this,c);b._apply.call(this,c);b._target.call(this,c)}})}};a.fn.raty=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist!")}}};a.fn.raty.defaults={cancel:false,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:undefined,precision:false,readOnly:false,round:{down:0.25,full:0.6,up:0.76},score:undefined,scoreName:"score",single:false,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:undefined,targetFormat:"{score}",targetKeep:false,targetScore:undefined,targetText:"",targetType:"hint"}})(jQuery);